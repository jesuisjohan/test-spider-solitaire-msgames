"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[302],{686:function(t,e,n){n.r(e),n.d(e,{default:function(){return S}});var r=n(22),a=n(2),i=n(20),u=n.n(i),o=n(48),s=n.n(o),c=n(58),d=n.n(c),h=n(153),l=n.n(h),p=n(66),f=n.n(p),m=n(672),v=n(225),y=n(690),w=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).name="SameContext",r.message=e||"The game attempted to perform a context switch into the current context.",r.code="SAME_CONTEXT",r.payload=n,r}return(0,a.Z)(e,t),e}((0,n(55).Z)(Error)),g=GameCore.Configs,x=g.LeadersBoard,b=g.Tournament,T=x.LeaderboardId,k=x.Limit,I=b.YourMockTournamentCount,P=function(){function t(t,e){this.id=void 0,this.title=void 0,this.contextId=void 0,this.payload=void 0,this.endTime=void 0,this.initialScore=void 0,this.id=t,this.title=this.id+"'s Tournament",this.contextId="000-"+this.id,this.initialScore=0;var n=["one","two","four"],r=["easy","medium","hard"];this.payload=s()({playerId:e||Phaser.Math.Between(1,5),playerName:"Player",leaderboardId:T,suitSize:n[Phaser.Math.Between(0,n.length-1)],difficulty:r[Phaser.Math.Between(0,r.length-1)]}),this.initEndTime(void 0!==e)}var e=t.prototype;return e.initEndTime=function(t){var e=this,n=t||e.id>7?7:e.id;this.endTime=Math.round((Date.now()+864e5*n)/1e3)},e.getID=function(){return this.id},e.getTitle=function(){return this.title},e.getPayload=function(){return this.payload},e.getEndTime=function(){return this.endTime},e.getContextID=function(){return this.contextId},e.getInitialScore=function(){return this.initialScore},e.setCreatePayload=function(t){var e=t.initialScore,n=t.config,r=t.data;this.initialScore=e,n&&(this.title=n.tournamentTitle),r&&(this.payload=s()(r))},t}(),C=function(t){function e(){var e,n;(n=t.call(this)||this).tournaments=void 0,n.tournamentData=void 0;var r=new P(1);return n.tournaments=[r],n.tournamentData=((e={})[1..toString()]=r,e),n.createYourMockTournaments(),n}(0,a.Z)(e,t);var n=e.prototype;return n.createAsync=function(){var t=(0,r.Z)(u().mark((function t(e){var n=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new(d())((function(t){var r,a=n.tournaments.length+1,i=new P(a,null==(r=e.data)?void 0:r.playerId);i.setCreatePayload(e),n.tournaments.push(i),n.tournamentData[a]=i,t(i)})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.shareAsync=function(){var t=(0,r.Z)(u().mark((function t(e){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new(d())((function(t){return t()})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.joinAsync=function(){var t=(0,r.Z)(u().mark((function t(e){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e in this.tournamentData){t.next=3;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 3:if(n=this.tournamentData[e],n.getContextID()!==FBInstant.context.getID()){t.next=7;break}return t.abrupt("return",d().reject(new w(null)));case 7:return t.prev=7,t.next=10,this.validateTournament(n);case 10:return t.next=12,GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0);case 12:return t.next=14,FBInstant.context.switchAsync(e);case 14:t.next=19;break;case 16:return t.prev=16,t.t0=t.catch(7),t.abrupt("return",d().reject(t.t0));case 19:return t.abrupt("return",d().resolve());case 20:case"end":return t.stop()}}),t,this,[[7,16]])})));return function(e){return t.apply(this,arguments)}}(),n.validateTournament=function(){var t=(0,r.Z)(u().mark((function t(e){var n,r,a,i,o,s;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getPayload(),r=JSON.parse(n),a=r.leaderboardId,i=[],t.prev=3,t.next=6,(0,v.H$)(a,{limit:k});case 6:i=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return",d().reject(t.t0));case 12:if(0!==i.length){t.next=14;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 14:if(o=window.game.player.getPlayerId(),l()(i).call(i,(function(t){return t.playerId===o}))){t.next=18;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 18:return s=null,t.prev=19,t.next=22,(0,v.xB)(o,a);case 22:s=t.sent,t.next=28;break;case 25:return t.prev=25,t.t1=t.catch(19),t.abrupt("return",d().reject(t.t1));case 28:if(s){t.next=30;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 30:return t.abrupt("return",d().resolve());case 31:case"end":return t.stop()}}),t,this,[[3,9],[19,25]])})));return function(e){return t.apply(this,arguments)}}(),n.getPromiseRejectTournamentNotFound=function(){return d().reject(new y.Z(null))},n.postScoreAsync=function(){var t=(0,r.Z)(u().mark((function t(e){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d().resolve());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.getTournamentsAsync=function(){var t=(0,r.Z)(u().mark((function t(){var e,n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f()(e=[]).call(e,this.tournaments),t.abrupt("return",n);case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.createYourMockTournaments=function(){for(var t=window.game.player.getPlayer(),e=t.playerId,n=t.name,r=0;r<I;r++){var a=1+r+1,i=new P(a);i.setCreatePayload({initialScore:0,config:{tournamentTitle:n+" 's Tournament"},data:{playerId:e,playerName:n,leaderboardId:T}}),this.tournaments.push(i),this.tournamentData[a]=i}},e}(m.J),S=C}}]);